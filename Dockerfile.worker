FROM node:20-alpine

WORKDIR /app

# CÃ i ffmpeg Ä‘áº§y Ä‘á»§ + bash
RUN apk add --no-cache ffmpeg bash

# Copy package.json vÃ  package-lock.json Ä‘á»ƒ cÃ i Ä‘Ãºng dependencies
COPY package*.json ./

# â— Quan trá»ng: CÃ i full cáº£ dependencies vÃ  devDependencies (Ä‘á»ƒ cÃ³ @types + ffprobe-static)
RUN npm install

# Copy toÃ n bá»™ mÃ£ nguá»“n vÃ o container
COPY . .

# Äáº·t biáº¿n mÃ´i trÆ°á»ng PORT cho Express
ENV PORT=8080

# Kiá»ƒm tra quyá»n ghi /tmp vÃ  cháº¡y worker
CMD sh -c 'echo "ğŸ§ª Kiá»ƒm tra quyá»n ghi /tmp:" && ls -ld /tmp && touch /tmp/testfile && echo "âœ… OK" && node dist/worker/process-video-worker.js'
